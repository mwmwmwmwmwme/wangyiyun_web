"use strict";(self["webpackChunkwangyiyun_web"]=self["webpackChunkwangyiyun_web"]||[]).push([[757],{4455:function(e,t,n){n.r(t),n.d(t,{default:function(){return W}});var a=n(2544),s=(n(1958),n(8089)),i=n(3396),r=n(9242),o=n(7139);const d=e=>((0,i.dD)("data-v-7a4b4e9e"),e=e(),(0,i.Cn)(),e),l={class:"editInfor"},u=d((()=>(0,i._)("div",{class:"editInfor_top"},[(0,i._)("span",null,"编辑个人信息")],-1))),c={class:"editInfor_bottom"},h={class:"perInfo"},g={class:"nickName"},m=d((()=>(0,i._)("div",{class:"nickNameLeft"},[(0,i._)("span",null,"昵称：")],-1))),p={class:"nickNameRight"},f={class:"introduce"},_=d((()=>(0,i._)("div",{class:"introduceLeft"},[(0,i._)("span",null,"介绍：")],-1))),k={class:"introduceRight"},v=["maxlength"],I={class:"maxlengthNum"},w={class:"gender"},C=d((()=>(0,i._)("div",{class:"genderLeft"},[(0,i._)("span",null,"性别：")],-1))),U={class:"genderRight"},y=(0,i.Uk)("男"),N=(0,i.Uk)("女"),b={class:"buttons"},x=d((()=>(0,i._)("span",null,"保存",-1))),S=[x],$=d((()=>(0,i._)("span",null,"取消",-1))),H=[$],D={class:"perHead"},R={class:"headBox"},F=["src"],L=d((()=>(0,i._)("div",{class:"headButton"},[(0,i._)("span",null,"修改头像")],-1)));function z(e,t,n,d,x,$){const z=s.Y,T=a.E;return(0,i.wg)(),(0,i.iD)("div",l,[u,(0,i._)("div",c,[(0,i._)("div",h,[(0,i._)("div",g,[m,(0,i._)("div",p,[(0,i.wy)((0,i._)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>x.userNickname=e)},null,512),[[r.nr,x.userNickname]])])]),(0,i._)("div",f,[_,(0,i._)("div",k,[(0,i.wy)((0,i._)("textarea",{class:"introduceInput",maxlength:x.maxlength,"onUpdate:modelValue":t[1]||(t[1]=e=>x.signatureContent=e)},null,8,v),[[r.nr,x.signatureContent]]),(0,i._)("div",I,[(0,i._)("span",null,(0,o.zw)(x.leftover),1)])])]),(0,i._)("div",w,[C,(0,i._)("div",U,[(0,i.Wm)(T,{shape:"dot",modelValue:x.genderChecked,"onUpdate:modelValue":t[2]||(t[2]=e=>x.genderChecked=e),"icon-size":"17px","checked-color":"#ec4141",onChange:$.genderChange},{default:(0,i.w5)((()=>[(0,i.Wm)(z,{name:"1",checked:1==x.genderChecked},{default:(0,i.w5)((()=>[y])),_:1},8,["checked"]),(0,i.Wm)(z,{name:"2",checked:2==x.genderChecked},{default:(0,i.w5)((()=>[N])),_:1},8,["checked"])])),_:1},8,["modelValue","onChange"])])]),(0,i._)("div",b,[(0,i._)("div",{class:"button saveButton",onClick:t[3]||(t[3]=(...e)=>$.saveUserInfo&&$.saveUserInfo(...e))},S),(0,i._)("div",{class:"button cancelButton",onClick:t[4]||(t[4]=e=>this.$router.go(-1))},H)])]),(0,i._)("div",D,[(0,i._)("div",R,[x.userHeadUrl?((0,i.wg)(),(0,i.iD)("img",{key:0,src:x.userHeadUrl},null,8,F)):(0,i.kq)("",!0)]),(0,i._)("input",{type:"file",style:{width:"150px","margin-left":"23px"},onChange:t[5]||(t[5]=(...e)=>$.handleFileUpload&&$.handleFileUpload(...e))},null,32),L])])])}var T=n(6265),V=n.n(T),B={data(){return{maxlength:300,genderChecked:0,signatureContent:"",leftover:300,userInfo:{},userNickname:"",userHeadUrl:""}},mounted(){this.userInfo=JSON.parse(sessionStorage.getItem("userInfo")),this.userNickname=this.userInfo.nickname,this.signatureContent=this.userInfo.signature,this.genderChecked=this.userInfo.gender,this.userHeadUrl=this.userInfo.avatarUrl},methods:{genderChange(){},handleFileUpload(e){var t=e.target.files[0];this.uploadHead(t)},async uploadHead(e){var t=new FormData;t.append("imgFile",e);const n=await this.getImgSize(e),a=sessionStorage.getItem("cookie"),s=(new Date).getTime(),i=await V()({baseURL:"http://localhost:3000/",method:"post",url:`/avatar/upload?cookie=${a}&imgSize=${n.width}&imgX=0&imgY=0&timestamp=${s}`,headers:{"Content-Type":"multipart/form-data"},data:t});this.userInfo.avatarUrl=this.userHeadUrl=i.data.data.url,sessionStorage.setItem("userInfo",JSON.stringify(this.userInfo))},getImgSize(e){return new Promise(((t,n)=>{let a=new FileReader;a.readAsDataURL(e),a.onload=function(e){let n=new Image;n.src=e.target.result,n.onload=function(){t({width:this.width,height:this.height})}}}))},saveUserInfo(){this.userInfo.nickname=this.userNickname,this.userInfo.signature=this.signatureContent;var e=parseInt(this.genderChecked);this.userInfo.gender=e,sessionStorage.setItem("userInfo",JSON.stringify(this.userInfo));const t=sessionStorage.getItem("cookie"),n=(new Date).getTime();setTimeout((async()=>{await V()({baseURL:"http://localhost:3000/",method:"post",url:`/user/update?cookie=${t}&gender=${e}&signature=${this.signatureContent}&nickname=${this.userNickname}&timestamp=${n}`,headers:{"Content-Type":"multipart/form-data"}});alert("修改个人资料成功")}),500)}},watch:{signatureContent(){this.leftover=300-this.signatureContent.length}}},J=n(89);const O=(0,J.Z)(B,[["render",z],["__scopeId","data-v-7a4b4e9e"]]);var W=O}}]);
//# sourceMappingURL=editInfor.2cfb76b2.js.map